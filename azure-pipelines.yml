# Node.js
# Build a general Node.js project with npm.
# Add steps that analyze code, save build artifacts, deploy, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/javascript
variables:
  majorVersion: 1
  minorVersion: $[counter(variables['majorVersion'], 0)]
  patchVersion: $[counter(format('{0}.{1}', variables['majorVersion'], variables['minorVersion']), 0)]
  versionNumber: '$(majorVersion).$(minorVersion).$(patchVersion)'

trigger:
- main

pool:
  opagent

steps:
- task: Bash@3
  displayName: 'Update Version'
  inputs:
    targetType: 'inline'
    script: |
          echo "Current Version: $(versionNumber)"
          #npm --no-git-tag-version version $(versionNumber) --allow-same-version

- script: |
    npm install
#   displayName: 'npm install and build'
# - script: npm publish
#   displayName: publish the package

- task: ArchiveFiles@2
  displayName: 'Archive files'
  inputs:
    rootFolderOrFile: '$(System.DefaultWorkingDirectory)'
    includeRootFolder: false
    archiveType: zip
    archiveFile: $(Build.ArtifactStagingDirectory)/$(Build.BuildId).zip
    replaceExistingArchive: false
- upload: $(Build.ArtifactStagingDirectory)/$(Build.BuildId).zip
  artifact: abhishek 

